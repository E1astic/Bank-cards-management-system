# Система управления банковскими картами

---

**Приложение для создания и управления банковскими картами, денежными переводами и пользователями. 
Используется аутентификация/авторизация и разделение ролей на ADMIN и USER.**

---

## В проекте используются:
- Java 21
- Spring Boot 3.5.3
- Spring Web
- Spring Data JPA
- Spring Security + JWT
- PostgreSQL
- Liquibase
- Docker
- OpenAPI (Swagger)

---

## Инструкция по запуску приложения:
1. Запустить файл `docker-compose.yaml` в корне проекта. Запустится база данных
   на порту **5443**.
2. Запустить класс `BankCardsApplication`. Приложение запустится на порту **8075**. 
   Миграции Liquibase будут накатываться автоматически.

* Документация Swagger будет доступна после запуска приложения  по адресу: http://localhost:8075/bank-cards/swagger-ui/index.html

---

## Основной функционал приложения:

### Администраторы:

1. Регистрируют новые банковские карты пользователям.
2. Имеют доступ ко всем картам (с возможностью постраничной выдачи данных).
3. Могут менять статус карты - ACTIVE, BLOCKED, EXPIRED. При блокировки карты статус всех 
   заявок на блокировку этой карты меняется на COMPLETED.
4. Могут блокировать карту в связи с истечением срока действия. 
    * С помощью вызова одного API выполняется поиск всех карт, у которых истекает срок действия. 
      Статус таких карт автоматичечки устанавливается в EXPIRED).
    * Есть API для проверки карт на истечение срока в текущую дату, а также в любую прошедшую дату, если
      администратор забыл или не успел выполнить проверку днями ранее).
5. Могут удалять карты. Эта карта удаляется из всех заявок на блокировку (без проблемы N + 1).
6. Видят все заявки пользователей на блокировку карт.
7. Меняют данные пользователя (все данные кроме ID и email).
8. Могут удалять пользователя. Тогда у всех его карт удаляется владелец (без проблемы N + 1).

### Пользователи:

1. Регистрируются и логинятся в приложении.
2. Имеют доступ ко всем своим картам (с возможностью постраничной выдачи данных).
3. Получают свои карты по ID.
4. Могут увидеть суммарный баланс всех своих активированных карт.
5. Могут увидеть баланс своей конкретной карты.
6. Могут отправить заявку на блокировку своей карты.
7. Совершают денежные переводы между своими картами.

---

### Везде, где происходит ввод информации, детально настроена валидация ошибок. 
**Пользователь информируется обо всех ошибках.**

**Примеры:**

1. Для совершения денежного перевода между картами необходимо, чтобы:
   * Обе карты существовали
   * Обе карты принадлежали текущему пользователю
   * Обе карты были активированы (без блокировки и без истечения срока действия)
   * На карте списания должно быть достаточно средств для перевода
2. Для регистрации пользователя необходимо, чтобы:
   * Email был корректным и уникальным
   * Номер телефона в корректном формате и уникальным
   * Пароль был не менее 8 символов
   * Фамилия, имя и отчество должны быть от 2 до 60 символов
3. Для отправки заявки на блокировку карты необходимо, чтобы:
   * Карта существовала
   * Карта принадлежала текущему пользователю
   * Карта не была уже заблокированной

